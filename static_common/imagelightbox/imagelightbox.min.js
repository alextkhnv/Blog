/* By Osvaldas Valutis, www.osvaldas.info. Available for use under the MIT License */
/* https://github.com/hovel/imagelightbox/tree/7a09d78 */
(function(f,g,n,J){var k=function(){var b=n.body||n.documentElement,b=b.style;return""==b.WebkitTransition?"-webkit-":""==b.MozTransition?"-moz-":""==b.OTransition?"-o-":""==b.transition?"":!1},r=!1===k()?!1:!0,t=function(b,f,g){var c={},e=k();c[e+"transform"]="translateX("+f+")";c[e+"transition"]=e+"transform "+g+"s linear";b.css(c)},B="ontouchstart"in g,C=g.navigator.pointerEnabled||g.navigator.msPointerEnabled,w=function(b){if(B)return!0;if(!C||"undefined"===typeof b||"undefined"===typeof b.pointerType)return!1;
if("undefined"!==typeof b.MSPOINTER_TYPE_MOUSE){if(b.MSPOINTER_TYPE_MOUSE!=b.pointerType)return!0}else if("mouse"!=b.pointerType)return!0;return!1};f.fn.imageLightbox=function(b){b=f.extend({dynamicalTargets:!1,allowedTypes:"png|jpg|jpeg|gif",groupByClosest:!1,zoomScale:[],animationSpeed:250,preloadNext:1,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1},b);var x="",s={},c=f([]),e=f(),d=f(),l=0,h=0,p=0,q=!1,u=1,k=function(a){return"a"==
f(a).prop("tagName").toLowerCase()&&RegExp(".("+b.allowedTypes+")$","i").test(f(a).attr("href"))},D=function(a){a=f(a);return a.length&&b.groupByClosest?a.closest(b.groupByClosest).data("lightbox-group")||"default":"default"},y=function(){f(x).each(function(){if(!k(this))return!0;var a=f(this),b=D(a);s[b]=s[b]||f([]);s[b]=s[b].add(a)})},E=function(a){if(q)return!1;q=!1;b.dynamicalTargets&&y();a=f(a);c=f(s[D(a)]);if(!c.length)return console.log("no such targets"),!1;if(!1!==b.onStart)b.onStart();e=
a.length?a:c.first();z()},I=function(){for(var a=b.zoomScale.length-1;0<=a;a--)if(g.devicePixelRatio>=b.zoomScale[a])return b.zoomScale[a];return 1},F=function(a){a=a.attr("href");if(-1!==a.indexOf("svg",a.length-3))return a;a=a.split(/([^@]+)(?:@[0-9]+\.?[0-9]?x)?(\.[^.]{1,4})/i);return 1===u?a[1]+a[2]:a[1]+"@"+u+"x"+a[2]},G=function(){if(!d.length)return!0;var a=0.8*f(g).width(),b=0.9*f(g).height(),c=new Image;c.src=d.attr("src");c.onload=function(){l=c.width/u;h=c.height/u;if(l>a||h>b){var e=l/
h>a/b?l/a:h/b;l/=e;h/=e}d.css({width:l+"px",height:h+"px",top:(f(g).height()-h)/2+"px",left:(f(g).width()-l)/2+"px"});d.show()}},z=function(a){if(q)return!1;var g=1,m=!1;"undefined"!=typeof a&&("left"==a?(g=-1,m=1):m=-1);var h=c.index(e);if(d.length){if(!1!==m&&(2>c.length||!0===b.quitOnEnd&&(-1===m&&0==h||1===m&&h==c.length-1)))return v(),!1;a={opacity:0};r?t(d,100*m-p+"px",b.animationSpeed/1E3):a.left=parseInt(d.css("left"))+100*m+"px";d.animate(a,b.animationSpeed,function(){H()});p=0}q=!0;if(!1!==
b.onLoadStart)b.onLoadStart();setTimeout(function(){u=I();d=f('<img id="imagelightbox" />').attr("src",F(e)).load(function(){d.hide().appendTo("body");G();var a={opacity:1};d.css("opacity",0);if(r)t(d,-100*m+"px",0),setTimeout(function(){t(d,"0px",b.animationSpeed/1E3)},50);else{var e=parseInt(d.css("left"));a.left=e+"px";d.css("left",e-100*m+"px")}d.animate(a,b.animationSpeed,function(){q=!1;if(!1!==b.onLoadEnd)b.onLoadEnd()});if(0<b.preloadNext)for(a=1;a<=b.preloadNext;a++){e=h+a*g;e>=c.length?
e-=c.length:0>e&&(e+=c.length);e=c.eq(e);if(!e.length)break;f("<img />").attr("src",F(e)).load()}}).error(function(){if(!1!==b.onLoadEnd)b.onLoadEnd()});var a=0,n=0,k=0;d.on(C?"pointerup MSPointerUp":"click",function(a){a.preventDefault();if(b.quitOnImgClick)return v(),!1;if(w(a.originalEvent))return!0;A(l/2>(a.pageX||a.originalEvent.pageX)-a.target.offsetLeft?"left":"right")}).on("touchstart pointerdown MSPointerDown",function(c){if(!w(c.originalEvent)||b.quitOnImgClick)return!0;r&&(k=parseInt(d.css("left")));
a=c.originalEvent.pageX||c.originalEvent.touches[0].pageX}).on("touchmove pointermove MSPointerMove",function(c){if(!w(c.originalEvent)||b.quitOnImgClick)return!0;c.preventDefault();n=c.originalEvent.pageX||c.originalEvent.touches[0].pageX;p=a-n;r?t(d,-p+"px",0):d.css("left",k-p+"px")}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(a){if(!w(a.originalEvent)||b.quitOnImgClick)return!0;50<Math.abs(p)?A(0<p?"right":"left"):r?t(d,"0px",b.animationSpeed/1E3):d.animate({left:k+
"px"},b.animationSpeed/2)})},b.animationSpeed+100)},A=function(a){if(q)return!1;if(-1>a||a>c.length)return console.log("index is out of range"),!1;var b=a,d=c.index(e);"left"==a?b=d-1:"right"==a&&(b=d+1);e=-1==b?c.eq(c.length-1):b==c.length?c.eq(0):c.eq(b);z(b<d?"left":"right")},H=function(){if(!d.length)return!1;d.remove();d=f()},v=function(){if(!d.length)return!1;d.animate({opacity:0},b.animationSpeed,function(){H();q=!1;if(!1!==b.onEnd)b.onEnd()})};f(g).on("resize",G);if(b.quitOnDocClick)f(n).on(B?
"touchend":"click",function(a){d.length&&!f(a.target).is(d)&&v()});if(b.enableKeyboard)f(n).on("keyup",function(a){if(!d.length)return!0;a.preventDefault();27==a.keyCode&&v();if(37==a.keyCode||39==a.keyCode)e=c.eq(c.index(e)-(37==a.keyCode?1:-1)),e.length||(e=c.eq(37==a.keyCode?c.length:0)),z(37==a.keyCode?"left":"right")});x=this.selector;f(n).on("click",x,function(a){if(!k(this))return!0;a.preventDefault();E(this)});y();this.start=E;this.collectTargets=y;this.switchImageLightbox=A;this.getTarget=
function(){return e};this.targetIsSingle=function(){return 2>c.length};this.targetIsFirst=function(){return b.quitOnEnd&&0==c.index(e)};this.targetIsLast=function(){return b.quitOnEnd&&c.index(e)==c.length-1};this.quitImageLightbox=function(){v();return this};return this}})(jQuery,window,document);
